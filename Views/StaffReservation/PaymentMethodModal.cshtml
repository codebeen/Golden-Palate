@model RRS.Models.ViewModels.ReservationDetailsViewModel

<!-- Payment Method Selection Modal -->
<div class="modal fade" id="paymentMethodModal-@Model.Id" tabindex="-1" aria-labelledby="paymentMethodModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header text-white" id="addEditHeader">
                <h5 class="modal-title" id="paymentMethodModalLabel">Select Payment Method</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center">
                <p>Please select your preferred payment method:</p>
                <div class="d-grid gap-3">
                    <form method="post" asp-controller="StaffReservation" asp-action="ShowCashModal" class="d-inline">
                        @Html.AntiForgeryToken()
                        <input type="hidden" name="id" value="@Model.Id" />
                        <button type="submit" class="btn btn-outline-info btn-lg text-dark">Cash</button>
                    </form>

                    <form method="post" asp-controller="Payment" asp-action="ProcessCashlessPayment" class="d-inline cashless-payment-form">
                        @Html.AntiForgeryToken()
                        <input type="hidden" name="id" value="@Model.Id" />
                        <button type="submit" class="btn btn-outline-info btn-lg text-dark w-100 cashless-payment-btn" type="submit">
                            <span class="button-text">Cashless</span>
                            <span class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>


<script>
    document.addEventListener('DOMContentLoaded', function () {
        const forms = document.querySelectorAll('.cashless-payment-form');

        forms.forEach(form => {
            form.addEventListener('submit', function (e) {
                const button = form.querySelector('.cashless-payment-btn');
                const buttonText = button.querySelector('.button-text');
                const spinner = button.querySelector('.spinner-border');

                // Disable button & show spinner inside
                button.disabled = true;
                buttonText.classList.add('d-none'); // Hide "Cashless"
                spinner.classList.remove('d-none'); // Show spinner
            });
        });

    });

    // function closeBothModals(reservationId) {
    //     const cashModal = document.getElementById(`cashModal-${reservationId}`);
    //     const paymentMethodModal = document.getElementById(`paymentMethodModal-${reservationId}`);

    //     const cashModalInstance = bootstrap.Modal.getInstance(cashModal);
    //     const paymentMethodModalInstance = bootstrap.Modal.getInstance(paymentMethodModal);

    //     if (cashModalInstance) cashModalInstance.hide();
    //     if (paymentMethodModalInstance) paymentMethodModalInstance.hide();

    //     Remove any lingering backdrops
    //     removeModalBackdrops();
    // }

    // function openCashModal(reservationId) {
    //     const paymentMethodModal = document.getElementById(`paymentMethodModal-${reservationId}`);
    //     const cashModal = new bootstrap.Modal(document.getElementById(`cashModal-${reservationId}`));

    //     Hide the payment method modal
    //     const paymentMethodModalInstance = bootstrap.Modal.getInstance(paymentMethodModal);
    //     if (paymentMethodModalInstance) {
    //         paymentMethodModalInstance.hide();
    //     }

    //     Ensure backdrop is removed before showing the new modal
    //     removeModalBackdrops();

    //     Show the cash modal
    //     cashModal.show();
    // }

    // function removeModalBackdrops() {
    //     const backdrops = document.querySelectorAll('.modal-backdrop');
    //     backdrops.forEach(backdrop => backdrop.remove());
    // }


</script>

<style>
    #addEditHeader {
        background: linear-gradient(to right, #0062cc, #0096ff);
        color: white;
    }
</style>
